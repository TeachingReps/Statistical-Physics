% !TEX spellcheck = en_US
% !TEX spellcheck = LaTeX
\documentclass[letterpaper,english,10pt]{article}
\input{../../header}

%opening
\title{Lecture-06: The fluctuation-dissipation theorem}
%\author{A R Shaarad}

\begin{document}
\maketitle
%\section{Thermodynamic potentials}
%In the study of the Boltzmann distribution, it is often useful to study a few functions depending on the system which summarize the system and provide useful information. Such functions are called thermodynamic potentials and are written as functions of the inverse temperature $\beta$. The following are the commonly used thermodynamic potentials.
%\begin{defn}[Free energy]
%The free energy $F(\beta)$ of the system is defined as
%$$F(\beta) = \frac{-1}{\beta} \log Z(\beta),$$
%where $Z(\beta)$ is the partition function.
%\end{defn}
%\begin{defn}[Free entropy]
%The free entropy $\Phi(\beta)$ of the system is defined as
%$$\Phi(\beta) = \log Z(\beta) = -\beta F(\beta)$$
%\end{defn}
%\begin{defn}[Internal energy]
%The internal energy $U(\beta)$ of the system is defined as
%$$U(\beta) = \frac{\partial}{\partial \beta} (\beta F(\beta))$$
%\end{defn}
%\begin{defn}[Canonical entropy]
%The canonical entropy $S(\beta)$ of the system is defined as
%$$S(\beta) = \beta^2 \frac{\partial F(\beta)}{\partial \beta}$$
%\end{defn}
%
%\subsection{Properties of thermodynamic potentials}
%The following are some useful properties of the above defined thermodynamic potentials.
%\begin{lem}
%\begin{itemize}
%\item $F(\beta) = U(\beta) - \frac{1}{\beta} S(\beta) = \frac{-1}{\beta} \Phi(\beta)$
%\begin{proof}
%That $F(\beta) = \frac{-1}{\beta} \Phi(\beta)$ is clear from the definition of $\Phi(\beta)$. Now,
%\begin{align*}
%U(\beta) = \frac{\partial}{\partial \beta} (\beta F(\beta)) \\
%	= \beta \frac{\partial F}{\partial \beta} + F(\beta) \\
%	= \beta \frac{S(\beta)}{\beta^2} + F(\beta) && \text{ from the definition of $S(\beta)$} \\
%\implies F(\beta) = U(\beta) - \frac{1}{\beta} S(\beta),
%\end{align*}
%which was what was wanted.
%\end{proof}
%\item $U(\beta) = \langle E \rangle$
%\begin{proof}
%\begin{align*}
%U(\beta) = \frac{\partial}{\partial \beta} (\beta F(\beta)) \\
%	= \frac{\partial}{\partial \beta} ( -\log Z(\beta)) \\
%	= \frac{-1}{Z(\beta)} \sum_{x \in \sX} \frac{\partial}{\partial \beta} e^{-\beta E(x)} \\
%	= \sum_{x \in \sX} E(x) \frac{e^{-\beta E(x)}}{Z(\beta)} \\
%	= \langle E \rangle
%\end{align*}
%\end{proof}
%\item The canonical entropy is equal to the Shannon entropy of the Boltzmann distribution upto a multiplicative constant and hence is non negative.
%\begin{proof}
%\begin{align*}
%S(\beta) = \beta^2 \frac{\partial}{\partial \beta} \left( \frac{-1}{\beta} \log Z(\beta) \right) \\
%	= \beta^2 \left[ \frac{\log Z(\beta)}{\beta^2} - \frac{1}{\beta Z(\beta)} \frac{\partial Z(\beta)}{\partial \beta} \right] \\
%	= \log Z(\beta) - \frac{\beta^2}{\beta Z(\beta)} \sum_{x \in \sX} \frac{\partial}{\partial \beta} e^{-\beta E(x)}\\
%	= \log Z(\beta) + \beta \sum_{x \in \sX} E(x) \mu_\beta (x)
%\end{align*}
%Now,
%\begin{align*}
%\mu_\beta(x) = \frac{e^{-\beta E(x)}}{Z(\beta)} \\
%\implies \log \mu_\beta(x) = - \beta E(x) - \log Z(\beta) \\
%\implies \beta E(x) = -\log \mu_\beta(x) - \log Z(\beta)
%\end{align*}
%Substituting this in the expression for $S(\beta)$, we obtain
%\begin{align*}
%S(\beta) = \log Z(\beta) + \sum_{x \in \sX} (-\log \mu_\beta(x) - \log Z(\beta)) \mu_\beta(x) \\
%	= - \sum_{x \in \sX} \mu_\beta(x) \log \mu_\beta(x) \\
%	= \frac{H(\mu_\beta)}{\log 2},
%\end{align*}
%where $H(\mu_\beta)$ is the Shannon entropy of the Boltzmann distibution.
%\end{proof}
%\item $ - \frac{\partial^2}{\partial \beta^2} (\beta F(\beta)) = \langle E^2 \rangle - \langle E \rangle^2$, i.e, the variance of $E(x)$.
%\begin{proof}
%\begin{align*}
%- \frac{\partial^2}{\partial \beta^2} (\beta F(\beta)) = - \frac{\partial}{\partial \beta} \left( \frac{\partial}{\partial \beta} (\beta F(\beta)) \right) \\
%	= - \frac{\partial}{\partial \beta} U(\beta) \\
%	= - \frac{\partial}{\partial \beta} \langle E \rangle \\
%	= - \frac{\partial}{\partial \beta} \sum_{x \in \sX} \frac{E(x) e^{- \beta E(x)}}{Z(\beta)} \\
%	= -\frac{1}{Z(\beta)} \sum_{x \in \sX} E(x) \frac{\partial}{\partial \beta} e^{- \beta E(x)} - \sum_{x \in \sX} E(x) e^{- \beta E(x)} \frac{\partial}{\partial \beta} \frac{1}{Z(\beta)} \\
%	= \sum_{x \in \sX} E(x)^2 \frac{e^{- \beta E(x)}}{Z(\beta)} + \sum_{x \in \sX} E(x) \frac{e^{- \beta E(x)}}{Z(\beta)^2} \sum_{y \in \sX} e^{- \beta E(y)} \\
%	= \sum_{x \in \sX} E(x)^2 \frac{e^{- \beta E(x)}}{Z(\beta)} - \left( \sum_{x \in \sX} E(x) \frac{e^{- \beta E(x)}}{Z(\beta)} \right) \left( \sum_{y \in \sX} E(y) \frac{e^{- \beta E(y)}}{Z(\beta)} \right) \\
%	= \langle E^2 \rangle - \langle E \rangle^2
%\end{align*}
%\end{proof}
%\item The free entropy function $\Phi(\beta)$ is convex in $\beta$.
%\begin{proof}
%\begin{align*}
%- \frac{\partial^2}{\partial \beta^2} \Phi(\beta) & - \frac{\partial^2}{\partial \beta^2} (\beta F(\beta)) \\
%	= \langle E^2 \rangle - \langle E \rangle^2 \\
%	= Var_{\mu_\beta}(E) \geq 0
%\end{align*}
%and hence $\Phi$ is convex.
%\end{proof}
%\end{itemize}
%\end{lem}
%
\section{Temperature limits of thermodynamic potentials}
We wish to study the behaviour of the thermodynamic potentials in the limiting cases of high temperature ($\beta \to 0$) and low temperature ($\beta \to \infty$).
\subsection{High temperature limit}
In the high temperature limit, we take $\beta \to 0$, and the Boltzmann distribution is approximately the uniform distribution over the set of all states in the state space $\sX$. 
Taking the Taylor series expansion around $\beta = 0$, we get that 
\EQ{
S(\beta) = H(\mu_\beta) = \log |\sX| + \Theta(\beta),
}
where $|\sX|$ denotes the cardinality of the state space $\sX$. 
The internal energy $U(\beta)$ is given by
\EQ{
U(\beta) = \inner{ E }_0 + \Theta(\beta),
}
where $\inner{ E }_0 = \frac{1}{|\sX|} \sum_{x \in \sX} E(x)$ is the internal energy at $\beta=0$. 
From the above equations, it can be seen that
\EQ{
F(\beta) = \inner{ E }_0 - \frac{1}{\beta}\log |\sX| + \Theta(\beta).
}
\subsection{Low temperature limit}
In the low temperature limit, we take $\beta \to \infty$ and the Boltzmann distribution is approximately the uniform distribution over the set of ground states with the lowest energy. 
Let $E_0$ be the ground state energy and $\sX_0$ be the ground state. 
For a finite configuration space $\sX$, we have 
\meq{2}{
&E_0 \triangleq \min\set{E(x): x \in \sX}, && \sX_0 \triangleq \{ x \in \sX : E(x) = E_0 \}.
}
\begin{defn}
The \textbf{energy gap} $\Delta E$ is defined to be the difference between the ground state energy level and the next lowest energy level, i.e.
\EQ{
\Delta E \triangleq \min \{ E(y) - E_0 : y \in \sX \setminus \sX_0 \}.
}
Let $\sX_1 \triangleq \{ x \in \sX : E(x) - E_0 = \Delta E \}$ be the set of states with the energy level $E_0 + \Delta E$. 
\end{defn}
Let the energy difference from the ground state energy be $\Delta E(x) \triangleq E(x) - E_0$, 
then we can write the internal energy in terms of ground state $\sX_0$, the ground state energy $E_0$, and the energy difference $\Delta E(x)$ as %in the neighbourhood of $\beta = \infty$ as 
\EQ{
U(\beta) = \sum_{x \in \sX} E(x) \mu_\beta (x) 
= \sum_{x \in \sX} (E_0 + \Delta E(x)) \mu_\beta (x) 
%= E_0\sum_{x \in \sX}  \mu_\beta (x) + \sum_{x \in \sX} (E(x) - E_0) \mu_\beta (x)
= E_0 + \sum_{x \in \sX_1} \Delta E \mu_\beta (x) + \sum_{x \in \sX \setminus (\sX_0\cup\sX_1)} \Delta E(x) \mu_\beta (x).
}
The partition function $Z(\beta)$ can be written in terms of $\sX_0, E_0$ and $\Delta E(x)$ as
\EQ{
Z(\beta) = \sum_{x \in \sX_0}e^{-\beta E(x)} + \sum_{x \notin \sX}e^{-\beta E(x)}= e^{-\beta E_0}\left(\abs{\sX_0} + \sum_{x \in \sX_1}e^{-\beta \Delta E} + \sum_{x \in \sX \setminus (\sX_0\cup\sX_1)}e^{-\beta \Delta E(x) }\right).
}
We can also write the Boltzmann distribution in terms of $\sX_0, E_0$ and $\Delta E(x)$ as 
\EQ{
\mu_\beta(x) = \frac{e^{-\beta E(x)}}{Z(\beta)}
= \frac{e^{-\beta E(x)}}{e^{-\beta E_0}\sum_{x \in \sX} e^{-\beta (E(x)-E_0)}} 
= \frac{e^{-\beta \Delta E(x)}}{|\sX_0| + \sum_{x \in \sX \setminus \sX_0} e^{-\beta \Delta E(x)}}.
}
From the above, it can be seen that for $x \notin \sX_0$, $\mu_\beta(x)$ is of the order of $e^{-\beta \Delta E}$ for large $\beta$.  
Therefore, we can write the internal energy for large $\beta$, in terms of $\sX_0, \sX_1$, and energy gap $\Delta E$ as 
\EQ{
U(\beta) 
= E_0 + \sum_{x \in \sX \setminus \sX_0} \Delta E(x) \mu_\beta (x) 
= E_0 + \sum_{x \in \sX_1} \Delta E \mu_\beta (x) + \sum_{x \in \sX \setminus (\sX_0 \cup \sX_1)} \Delta E(x) \mu_\beta (x) 
\implies U(\beta) = E_0 + \Theta(e^{-\beta \Delta E})
}
Recall that $\log |\sX_0|$ is the entropy of the uniform distribution over the ground state. 
Hence, we can write the canonical entropy for large $\beta$ in a similar fashion 
\EQ{
S(\beta) = \log |\sX_0| + \Theta(e^{-\beta \Delta E}). 
}
Combining the expression for internal energy and canonical entropy, we can write the free energy for large $\beta$ as
\EQ{
F(\beta) = E_0 - \frac{1}{\beta} \log |\sX_0| + \Theta(e^{-\beta \Delta E}).
}
%\subsection{Examples}
In many settings, the high temperature case is not very interesting since the system is almost uniformly random. S
o, we now consider a few example systems and study the thermodynamic potentials in the general case and in the low temperature limit where $\beta \to \infty$. 
\begin{shaded*}
\begin{exmp}[Two level system]
Consider a system consisting of only two states, $\sX = \{1, 2 \}$ with the energy function given by
$E(1) = \epsilon_1,\; E(2) = \epsilon_2$. 
Without loss of any generality, we can assume $\epsilon_1 < \epsilon_2$, and consequently define the energy gap as $\Delta = \epsilon_2 - \epsilon_1$. 
The partition function can be computed to be 
\EQ{
Z(\beta) = \sum_{x \in \sX} e^{-\beta E(x)} 
	= e^{-\beta \epsilon_1} + e^{-\beta \epsilon_2}
	= e^{-\beta \epsilon_1}(1 + e^{-\beta \Delta}), 
}
and the Boltzmann distribution is given by
\EQ{
\mu_\beta =  \Big( \frac{1}{1 + e^{-\beta \Delta}}, \frac{e^{-\beta \Delta}}{1 + e^{-\beta \Delta}} \Big).
}
We can compute the free energy as 
\EQ{
F(\beta) = -\frac{1}{\beta} \log Z(\beta) 
= -\frac{1}{\beta} \log \bigg( e^{-\beta \epsilon_1}(1 + e^{-\beta \Delta})\bigg) 
= \epsilon_1 - \frac{1}{\beta} \log(1 + e^{-\beta \Delta}).
}
The internal energy can be computed to be 
\EQ{
U(\beta) = \inner{ E } 
= \frac{\epsilon_1 + (\epsilon_1+\Delta) e^{-\beta \Delta}}{1+ e^{-\beta\Delta}} 
= \epsilon_1 + \Delta\frac{ e^{-\beta \Delta}}{1 + e^{-\beta \Delta}}.
}
We can either compute the canonical entropy directly as $S(\beta) = H(\mu_\beta)$ or compute it to be
\EQ{
S(\beta) = \beta(U(\beta) - F(\beta))
%= \frac{1}{1 + e^{-\beta \Delta}} \Bigg[ \log(1 + e^{-\beta \Delta}) + e^{-\beta \Delta} \log\bigg(\frac{1 + e^{-\beta \Delta}}{e^{-\beta \Delta}}\bigg)\Bigg] 
%= \frac{1}{1 + e^{-\beta \Delta}} \Bigg[ \log(1 + e^{-\beta \Delta}) + e^{-\beta \Delta} \log(1 + e^{-\beta \Delta}) - \log (e^{-\beta \Delta})\Bigg] 
= \beta \Delta\frac{e^{-\beta \Delta}}{1 + e^{-\beta \Delta}} + \log(1 + e^{-\beta \Delta}).
}
From the above equations, we see that, at low temperatures (for high values of $\beta$),
\meq{2}{
&U(\beta) = \epsilon_1 + O(e^{-\beta \Delta}), &&
S(\beta) = \log (1) + O(e^{-\beta \Delta}).
}
which is intuitive, since $\epsilon_1$ is the energy of the ground state and $\log(1) = 0$ is the entropy of the uniform distribution over the ground state since it consists of only one state, and the extra terms are in the order of $e^{-\beta \Delta}$, which was what was expected.
\end{exmp}
\end{shaded*}

\begin{shaded*}
\begin{exmp}[Cylindrical bottle]
Consider a single particle in a cylindrical bottle with configuration space $\sX = B \times [0,d]$, where the base of the cylinder $B$ is of arbitrary shape with area $\abs{B}$. 
Let the energy function be the potential energy, $E(x) = wh(x)$, where $h(x)$ is the height of $x$ from the base of the cylinder and $w$ is a scalar. 
We can then compute the partition function for the continuous Boltzmann distribution as
\EQ{
Z(\beta) = \int_{x \in \sX} e^{-\beta E(x)} dx 
= |B| \int_0^d e^{-\beta w u} du 
	%= |B| \left. \frac{e^{-\beta w u}}{- \beta w} \right|_0^d 
%\implies Z(\beta) 
= \frac{|B|}{\beta w} \left( 1 - e^{-\beta w d} \right).
}
The free energy is then given by 
\EQ{
F(\beta) = -\frac{1}{\beta} \log Z(\beta) 
= -\frac{1}{\beta} \log |B| - \frac{1}{\beta} \log \left( \frac{1 - e^{-\beta wd}}{\beta w} \right).
}
The internal energy is given by
\EQ{
U(\beta) = \inner{ E } 
= \int_{x \in \sX} \frac{E(x) e^{- \beta E(x)}}{Z(\beta)} du 
= \frac{\beta w}{(1 - e^{-\beta wd})} \int_0^d wu e^{-\beta wu} du 
%= \frac{\beta w}{1 - e^{-\beta wd}} \left. \left( \frac{-\beta wu e^{-\beta wu} - e^{-\beta wu}}{\beta^2 w} \right) \right|_0^d 
%= \frac{1}{e^{-\beta wd} - 1} \left( \frac{e^{-\beta wd} - 1 + \beta wd e^{-\beta wd}}{\beta} \right) 
= \frac{1}{\beta} - \frac{wd}{e^{\beta wd} - 1}.
}
From the above, we can determine the canonical entropy as
\EQ{
S(\beta) = \beta (U(\beta) - F(\beta)) 
= 1 - \frac{\beta wd}{e^{\beta wd} - 1} + \log |B| + \log \left( \frac{1 - e^{- \beta wd}}{\beta w} \right) 
= \log \left( \frac{|B|e}{\beta w} \right) - \frac{\beta wd}{e^{\beta wd} - 1}. 
%= \log \left( \frac{|B|e}{\beta w} \right) + \Theta(e^{- \beta wd})
}
In the low temperature limit, we see that the second term vanishes. Comparing it with the intuition that at low temperatures, the entropy is the logarithm of the size of the ground state, we see that in the low temperature limit, the particle in the cylinder occupies a volume of order $\frac{|B|e}{\beta w}$. Since the area of the base is $|B|$, the cylinder is occupied up to a height of order $\frac{e}{\beta w}$ from the base.
\end{exmp}
\end{shaded*}

\begin{shaded*}
\begin{exmp}[Spherical bottle]
Consider the system in which a particle is confined to a sphere $\sX$ of radius $R$ centred at $(R,0,0)$ in the cartesian coordinate, 
where the configuration space is given by
\EQ{
\sX = \{(x_1, x_2, x_3) : (x_1-R)^2 + x_2^2 + x_3^2 \le R^2  \}.
}
%at $(0,0,0)$ in the spherical coordinate. 
%The configuration space is given by
%\EQ{
%\sX = \{(r, \theta, \phi) : r \le R, \theta \in [0, \pi), \phi \in [0, 2\pi)  \}.
%}
%Let the energy function be the potential energy, proportional to the height from the $(r\sin\theta\cos\phi, r\sin\theta\sin\phi)$ plane, i.e,
%\EQ{ 
%E(x) = w r\cos\theta.
%}
%Then, we can compute the partition function as 
%\EQ{
%Z(\beta) = \int_{x \in \sX}\mu_\beta(x)dx = 2\pi\int_{0}^R dr \int_0^\pi d\theta e^{-\beta w r\cos\theta}
%}
Let the energy function be the potential energy, proportional to the height from the $(x_2, x_3)$ plane, i.e,
\EQ{ 
E(x) = w x_1.
}
Then, we can write the partition function as
\EQ{
Z(\beta) = \int_\sX e^{-\beta w x_1} dx_1 dx_2 dx_3 
	= \int_0^{2R} dx_1e^{-\beta w x_1} \int_{S_{x_1}} dx_2 dx_3,
}
where $S_{x_1}$ is the subset of $\sX$ at height $x_1$ from the $(x_2, x_3)$ plane. 
Clearly, $S_{x_1}$ is a circle of radius $\sqrt{R^2 - (x_1-R)^2}$ and hence its area is $ \pi (R^2 - (x_1-R)^2) = \pi(2Rx_1 - x_1^2)$. 
Therefore, we can compute the partition function to be
\EQN{
\label{eq:6}
Z(\beta) = \int_0^{2R} \pi (2Rx_1 - x_1^2) e^{-\beta w x_1} dx_1 
=\frac{2\pi R}{(\beta w)^2} \left[ e^{-2 \beta wR} \left( 1 + \frac{1}{\beta w R} \right) + 1 - \frac{1}{\beta wR} \right].
%&= 2 \pi R \int_0^{2R} u e^{-\beta wu} du - \pi \int_0^{2R} u^2 e^{-\beta wu} du \\
%&= \frac{\pi}{\beta w} \bigg[ -4R^2 e^{-2 \beta wR} - \frac{2R e^{-2 \beta wR}}{\beta w} + \frac{2R}{\beta w} + 4R^2 e^{-2 \beta wR}  \\
%&\qquad \qquad + \frac{4R e^{-2 \beta wR}}{\beta w} + \frac{2e^{-2 \beta wR}}{(\beta w)^2} - \frac{2}{(\beta w)^2} \bigg]. 
}
%This implies that the partition function is given by
%\EQN{
%\label{eq:6}
%Z(\beta) = \frac{2\pi R}{(\beta w)^2} \left[ e^{-2 \beta wR} \left( 1 + \frac{1}{\beta w R} \right) + 1 - \frac{1}{\beta wR} \right] 
%}
Now, we can calculate the free energy in terms of partition function as 
\EQ{
F(\beta) 
= -\frac{1}{\beta} \log Z(\beta) 
= -\frac{1}{\beta} \log \left( \frac{2 \pi R}{(\beta w)^2} \right) - \frac{1}{\beta} \log \left( \frac{e^{-2 \beta wR}(\beta wR + 1) + \beta wR - 1}{\beta wR} \right), 
}
and internal energy as the expected energy under the Boltzmann distribution as 
\EQ{
U(\beta) = \inner{ E } 
= \frac{1}{Z(\beta)} \int_{x \in \sX} wx_1 e^{- \beta wx_1} dx 
= \frac{w \pi}{Z(\beta)} \int_0^{2R} u(2Ru - u^2) e^{-\beta wu} du. 
}
We can explicitly compute the integration to obtain
\EQ{
U(\beta) = \frac{w \pi}{Z(\beta)} \left[ \frac{4R^2}{(\beta w)^2}e^{-2 \beta wR} + \frac{8R}{(\beta w)^3}e^{-2 \beta wR} + \frac{6}{(\beta w)^4}e^{-2 \beta wR} + \frac{4R\beta w - 6}{(\beta w)^4} \right].
}
From substituting equation~\eqref{eq:6} for the partition function in above, we obtain in the low temperature limit (for  $\beta$ large)
\EQ{
U(\beta) \approx \left( \frac{4 \pi R \beta w^2}{(\beta w)^4} - \frac{6w \pi}{(\beta w)^4} \right) \frac{1}{Z(\beta)} 
	= \left( \frac{4 \pi R \beta w^2}{(\beta w)^4} - \frac{6w \pi}{(\beta w)^4} \right) \frac{\beta w^2}{2 \pi R} \left(\frac{1}{1 - \frac{1}{R \beta w}}\right).
}
Using the expansion $\frac{1}{1-x} = 1 + x + x^2 + ...$, we obtain
\EQ{
U(\beta) = w \left( \frac{2}{\beta w} + \frac{3}{(\beta w)^2 R} \right) \left( 1 + \frac{1}{\beta w R} + \Theta\left(\frac{1}{\beta ^ 2}\right) \right) 
= \frac{2}{\beta} + \Theta\left(\frac{1}{\beta^2}\right).
}
Therefore, the canonical entropy in the low temperature limit is given by
\EQ{
S(\beta) = \beta ( U(\beta) - F(\beta) ) 
= \beta \frac{2}{\beta} + \beta \Theta\left(\frac{1}{\beta^2}\right) + \log \left( \frac{2 \pi R}{(\beta w)^2} \right) 
%= \log e^2 + \log \left( \frac{2 \pi R}{(\beta w)^2} \right) + \Theta\left(\frac{1}{\beta}\right) 
= \log \left( \frac{2 \pi e^2 R}{\beta^2 w^2} \right) + \Theta\left(\frac{1}{\beta}\right).
}
In a low temperature state, since the distribution is uniform over the ground state and the entropy is the logarithm of the size of the ground state, we see intuitively that the particle occupies a volume of the order of $\left( \frac{2 \pi Re^2}{\beta^2 w^2} \right)$ at the bottom of the sphere.
\end{exmp}
\end{shaded*}

\section{Fluctuation-dissipation relations}
Until now, we have considered systems in which the energy function is purely a function of the state. 
Now, we consider systems in which the energy function is parametrized by a real scalar $\lambda$ and hence is of the form $E_\lambda(x)$, or any configuration $x \in \sX$.
We further assume that the parametrization is smooth and the energy function can be expanded into a Taylor series about a value $\lambda_0$. 
Thus, we have
\EQN{
\label{eq:EnergyExpansion}
E_\lambda(x) = E_{\lambda_0}(x) + (\lambda - \lambda_0)\left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}(x) + \Theta((\lambda - \lambda_0)^2).
}
From equation~\eqref{eq:EnergyExpansion}, we can expand the following ratio of partition functions as 
\EQ{
\label{eq:PartitionRatioInitial}
\frac{Z_\lambda(\beta)}{Z_{\lambda_0}(\beta)} = \frac{1}{Z_{\lambda_0}(\beta)} \sum_{x \in \sX} e^{-\beta E_{\lambda}(x)} 
= \frac{1}{Z_{\lambda_0}(\beta)} \sum_{x \in \sX} \exp\left(-\beta E_{\lambda_0}(x)-\beta (\lambda - \lambda_0)\left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}(x) + \Theta((\lambda - \lambda_0)^2)\right).
}
Using the Taylor's expansion for the exponential $e^x = 1 + x + \Theta(x^2)$, we obtain
\EQN{
 \label{eq:ExpEnergyExpansion}
e^{-\beta (\lambda - \lambda_0)\left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}(x)} = 1 - \beta (\lambda - \lambda_0) \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}(x) + \Theta((\lambda - \lambda_0)^2). 
}
We can denote the Boltzmann distribution for state $x$ for parameter $\lambda$ as $\mu_{\beta,\lambda}(x) = \frac{e^{\beta E_\lambda(x)}}{Z_\lambda(x)}$, 
and expected value of an observable $\cO$ under Boltzmann distribution $\mu_{\beta, \lambda}$ as $\inner{\cO}_{\lambda}$. 
Substituting equation~\eqref{eq:ExpEnergyExpansion} in equation~\eqref{eq:PartitionRatioInitial}, 
we obtain
\EQN{
\label{eq:PartionFunctionRatioExpansion}
\frac{Z_\lambda(\beta)}{Z_{\lambda_0}(\beta)} = \sum_{x \in \sX} \mu_{\beta,\lambda_0}(x) \left( 1 - \beta (\lambda - \lambda_0) \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}(x) + \Theta((\lambda - \lambda_0)^2) \right) 
= 1  - \beta(\lambda-\lambda_0)\inner{  \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}}_{\lambda_0}+ \Theta((\lambda - \lambda_0)^2).
}
%Now
%\EQ{
%\sum_{x \in \sX} e^{-\beta E_{\lambda_0}(x)} = Z_{\lambda_0}(\beta).
%}
%and the second term is clearly the expected value of $\beta (\lambda - \lambda_0) \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}(x)$ under the Boltzmann distribution with energy function parametrized by $\lambda = \lambda_0$, which we denote by
%\EQ{
%\inner{ \beta (\lambda - \lambda_0) \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}(x) }_{\lambda_0} = \beta (\lambda - \lambda_0) \inner{ \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}(x) }_{\lambda_0}.
%}
%Substituting the above in equation~\eqref{eq:PartionFunctionRatioExpansion}, we obtain
%\EQ{
%\label{eq:PartionFunctionExpansion}
%Z_\lambda(\beta) = Z_{\lambda_0}(\beta) \left[ 1 - \beta (\lambda - \lambda_0) \inner{ \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0} }_{\lambda_0} + \Theta((\lambda - \lambda_0)^2) \right].
%}
Using this expansion for partition function,  
we can infer the behavior of the system at parameter value $\lambda$ in the neighborhood of $\lambda_0$. 

We can find the partial derivative of free entropy $\Phi_\lambda(\beta) = \log Z_\lambda (\beta) $ with respect to the parameter $\lambda$ evaluated at the value $\lambda_0$ as 
\EQN{
\label{eq:FreeEntropyDerivative}
%\Phi_\lambda(\beta) = \log Z_\lambda (\beta) 
%\implies 
\left. \frac{\partial \Phi_\lambda(\beta)}{\partial \lambda} \right|_{\lambda_0} = \left. \frac{1}{Z_\lambda (\beta)} \frac{\partial}{\partial \lambda} Z_\lambda (\beta) \right|_{\lambda_0} 
= \frac{1}{Z_{\lambda_0} (\beta)} \left. \frac{\partial}{\partial \lambda} Z_\lambda (\beta) \right|_{\lambda_0} 
=-\beta \inner{ \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0} }_{\lambda_0}. 
}
Where the last equality follows from eq (\ref{eq:PartionFunctionRatioExpansion}), which implies that 
$$\left. \frac{\partial}{\partial \lambda} Z_\lambda (\beta) \right|_{\lambda_0} = -\beta Z_{\lambda_0}(\beta) \inner{ \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0} }_{\lambda_0}$$
%Substituting the above in equation~\eqref{eq:FreeEntropyDerivative}, we obtain
%\EQ{
%\left. \frac{\partial \Phi_\lambda(\beta)}{\partial \lambda} \right|_{\lambda_0} = -\beta \inner{ \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}(x) }_{\lambda_0}
%}

\begin{thm}[Fluctuation-dissipation theorem]
For any observable $\cO: \sX \to \R$,
\EQ{
\inner{ \cO }_{\lambda} = \inner{ \cO }_{\lambda_0} - \beta (\lambda - \lambda_0) \inner{ \cO; \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0} }_{\lambda_0} + \Theta((\lambda - \lambda_0)^2),
}
where $\inner{ X; Y }_{\lambda}$ denotes the covariance of $X$ and $Y$ under the Boltzmann distribution for parameter $\lambda$.
\end{thm}
\begin{proof}
Using equation~\eqref{eq:ExpEnergyExpansion} for expansion of $e^{-\beta E_\lambda(x)}$ in terms of $e^{-\beta E_{\lambda_0}(x)}$ and equation~\eqref{eq:PartionFunctionRatioExpansion} for expansion of the partition function $Z_\lambda(x)$ in terms of $Z_{\lambda_0}(x)$,  
we can write the expectation of observable $\cO$ for system parameter $\lambda$ in the neighborhood of $\lambda_0$ as 
\EQ{
\inner{ \cO }_{\lambda} = \sum_{x \in \sX} \frac{\cO(x) e^{-\beta E_\lambda(x)}}{Z_\lambda(x)} 
= \sum_{x \in \sX} \frac{\cO(x) e^{-\beta E_{\lambda_0}(x)}\left( 1 - \beta (\lambda - \lambda_0) \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}(x) + \Theta((\lambda - \lambda_0)^2) \right)}{Z_{\lambda_0}(\beta) \left[ 1 - \beta (\lambda - \lambda_0) \inner{ \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}}_{\lambda_0} + \Theta((\lambda - \lambda_0)^2) \right]}.
}
Using the expansion $\frac{1}{1-y} = 1 + y + y^2 + ...$, the denominator can be brought to the numerator, to obtain
\EQ{
\begin{aligned}
\inner{ \cO }_{\lambda} &= \sum_{x \in \sX} \mu_{\beta,\lambda_0}(x)\cO(x)
	\left[ 1 - \beta (\lambda - \lambda_0) \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}(x) + \Theta((\lambda - \lambda_0)^2) \right]
	\times \left[ 1 + \beta (\lambda - \lambda_0) \inner{ \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0} }_{\lambda_0} + \Theta((\lambda - \lambda_0)^2) \right]\\
= &\sum_{x \in \sX} \mu_{\beta,\lambda_0}(x)
	\Bigg[
	\cO(x) -  \beta(\lambda - \lambda_0) \bigg( \cO(x) \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}(x) - \cO(x) \inner{ \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0} }_{\lambda_0}  + \Theta((\lambda - \lambda_0)^2) \bigg)
	\Bigg]\\
%\end{aligned}
%}
%\EQ{
%\implies \inner{ \cO }_{\lambda} = \sum_{x \in \sX} \mu_{\beta,\lambda_0}(x) \cO(x)  
%- \beta (\lambda - \lambda_0)\sum_{x \in \sX} \mu_{\beta,\lambda_0}(x) \cO(x) \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}(x) 
% + \beta (\lambda - \lambda_0) \inner{ \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0}(x) }_{\lambda_0} \sum_{x \in \sX} \mu_{\beta,\lambda_0}(x) \cO(x) 
% + \Theta((\lambda - \lambda_0)^2)
%}
%\EQ{
%\implies \inner{ \cO }_{\lambda} 
&= \inner{ \cO }_{\lambda_0} - \beta (\lambda - \lambda_0) \left[ \inner{ \cO \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0} }_{\lambda_0} - \inner{ \cO }_{\lambda_0} \inner{ \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0} }_{\lambda_0} \right]  + \Theta((\lambda - \lambda_0)^2).% \\
%&= \inner{ \cO }_{\lambda_0} - \beta (\lambda - \lambda_0) \inner{ \cO, \left. \frac{\partial E}{\partial \lambda} \right|_{\lambda_0} }_{\lambda_0} + \Theta((\lambda - \lambda_0)^2),
\end{aligned}
}
Result follows from the definition of covariance under the Boltzmann distribution. 
\end{proof}
\end{document}